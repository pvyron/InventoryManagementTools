@page "/file/share"
@using InMa.Shopping.Data.Repositories.Abstractions
@using InMa.Shopping.Data.Repositories.Implementations
@using Microsoft.AspNetCore.Authorization
@using InMa.Shopping.Components.FileSharing.Shared
@using Nager.Country
@rendermode InteractiveServer
@attribute [Authorize]

<PageTitle>File-sharing</PageTitle>

<FluentInputFile @ref="@myFileByStream"
                 AnchorId="MyUploadStream"
                 DragDropZoneVisible="false"
                 Mode="InputFileMode.Stream"
                 Multiple="true"
                 MaximumFileSize="@(_maxFileSizeInBytes)"
                 @* Accept=".mp4, .mov, .avi" *@
                 @* OnFileUploaded="@OnFileUploadedAsync" *@
                 @* OnCompleted="@OnCompleted" *@
                 OnInputFileChange="@OnFilesSelectedAsync"/>

<FluentProgress Min="0" Max="browserFiles.Length" Value="@progressPercent" Visible="@(progressPercent > 0)" />
<FluentLabel Alignment="HorizontalAlignment.Center">
    @progressTitle
</FluentLabel>

<FluentButton Appearance="Appearance.Accent" Id="MyUploadStream">
    Choose files
</FluentButton>

@if (browserFiles.Any())
{

    <FluentGrid>
        <FluentGridItem xs="12" sm="6" md="4">
            <FluentSelect Label="Country" 
                          Height="300px"
                          Items="@(new CountryProvider().GetCountries().Select(c => new {c.Alpha2Code, c.CommonName, c.OfficialName}))"
                          OptionValue="@(c => c.Alpha2Code.ToString())"
                          OptionText="@(p => p.CommonName + ", " + p.OfficialName)"></FluentSelect>
        </FluentGridItem>
        <FluentGridItem xs="12" sm="6" md="4">
            <FluentTextField Label="Region"></FluentTextField>
        </FluentGridItem>
        <FluentGridItem xs="12" sm="6" md="4">
            <FluentTextField Label="City"></FluentTextField>
        </FluentGridItem>
        <FluentGridItem xs="12" sm="6" md="4">
            <FluentDatePicker Label="Date of Capture" View="CalendarViews.Days"/>
        </FluentGridItem>
        <FluentGridItem xs="12" Justify="JustifyContent.FlexStart">
            <h4>File(s) to upload:</h4>
        </FluentGridItem>
        @foreach (var (file, fileIndex) in browserFiles)
        {
            <FluentGridItem xs="12" Justify="JustifyContent.FlexStart">
                <FluentTextField Label="File name" Value="@file.Name"></FluentTextField>
                <FluentTextField Label="Content type" Value="@file.ContentType"></FluentTextField>
                <FluentTextField Label="Last modified" Value="@file.LastModified.ToString("f")"></FluentTextField>
                <p>Size: @(file.Size.ToString("N0")) bytes</p>
            </FluentGridItem>
        }
    </FluentGrid>
}

<FluentButton Appearance="Appearance.Accent" OnClick="@UploadAllButtonClicked">
    Upload files
</FluentButton>